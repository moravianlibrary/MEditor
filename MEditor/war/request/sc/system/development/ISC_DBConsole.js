
/*

  SmartClient Ajax RIA system
  Version 8.0/LGPL Development Only (2010-05-18)

  Copyright 2000 and beyond Isomorphic Software, Inc. All rights reserved.
  "SmartClient" is a trademark of Isomorphic Software, Inc.

  LICENSE NOTICE
     INSTALLATION OR USE OF THIS SOFTWARE INDICATES YOUR ACCEPTANCE OF
     ISOMORPHIC SOFTWARE LICENSE TERMS. If you have received this file
     without an accompanying Isomorphic Software license file, please
     contact licensing@isomorphic.com for details. Unauthorized copying and
     use of this software is a violation of international copyright law.

  DEVELOPMENT ONLY - DO NOT DEPLOY
     This software is provided for evaluation, training, and development
     purposes only. It may include supplementary components that are not
     licensed for deployment. The separate DEPLOY package for this release
     contains SmartClient components that are licensed for deployment.

  PROPRIETARY & PROTECTED MATERIAL
     This software contains proprietary materials that are protected by
     contract and intellectual property law. You are expressly prohibited
     from attempting to reverse engineer this software or modify this
     software for human readability.

  CONTACT ISOMORPHIC
     For more information regarding license rights and restrictions, or to
     report possible license violations, please contact Isomorphic Software
     by email (licensing@isomorphic.com) or web (www.isomorphic.com).

*/

if(window.isc&&window.isc.module_Core&&!window.isc.module_DBConsole){isc.module_DBConsole=1;isc._moduleStart=isc._DBConsole_start=(isc.timestamp?isc.timestamp():new Date().getTime());if(isc._moduleEnd&&(!isc.Log||(isc.Log && isc.Log.logIsDebugEnabled('loadTime')))){isc._pTM={ message:'DBConsole load/parse time: ' + (isc._moduleStart-isc._moduleEnd) + 'ms', category:'loadTime'};
if(isc.Log && isc.Log.logDebug)isc.Log.logDebug(isc._pTM.message,'loadTime')
else if(isc._preLog)isc._preLog[isc._preLog.length]=isc._pTM
else isc._preLog=[isc._pTM]}isc.definingFramework=true;isc.defineClass("DBConsole","TabSet");isc.A=isc.DBConsole.getPrototype();isc.A.dbConfiguratorConstructor="DBConfigurator";isc.A.dsImporterConstructor="DSImporter";isc.A=isc.DBConsole.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.creatorName="dbConsole";isc.B.push(isc.A.initWidget=function isc_DBConsole_initWidget(){this.Super("initWidget",arguments);this.dbConfigurator=this.createAutoChild("dbConfigurator");this.dsImporter=this.createAutoChild("dsImporter");var _1=window.location.toString().match(/[?&](?:target)=([^&]*)/);var _2=(_1&&_1[1]=="dsImporter");this.addTabs([{ID:"dbConfigurator",title:"Database Configuration",pane:this.dbConfigurator},{ID:"dsImporter",title:"Import DataSources",pane:this.dsImporter}]);if(_2)this.selectTab("dsImporter");isc.RPCManager.startQueue();this.dbConfigurator.getDefinedDatabases();this.dsImporter.getDefinedDataSources();isc.RPCManager.sendQueue()}
);isc.B._maxIndex=isc.C+1;isc.defineClass("DSImporter","VLayout");isc.A=isc.DSImporter.getPrototype();isc.A.dsListDefaults={_constructor:"ListGrid",sortFieldNum:0,fields:[{name:"dsName",title:"DataSource ID",width:"*"},{name:"dsType",title:"Type",width:100},{name:"testData",title:"Test Data",width:60}],contextMenu:{data:[{title:"Select All",click:"target.selection.selectAll()"},{title:"DeSelect All",click:"target.selection.deselectAll()"},{isSeparator:true},{title:"Refresh",click:"target.dsImporter.getDefinedDataSources()"}]},selectionChanged:function(_1,_2){var _3=this.getSelection(),_4=this.creator.dsViewer;_4.setData(_3);if(_3&&_3.length>0){var _5=this.creator.dsContents;isc.DS.get(_3[0].dsName,function(_6){_5.setDataSource(_6);_5.fetchData(null,function(_7){if(_7.status<0)_5.setData([])},{willHandleError:true})})}}};isc.A.dsListToolbarDefaults={_constructor:"Toolbar",buttons:[{title:"Refresh",width:100,click:"this.parentElement.creator.getDefinedDataSources()"}]};isc.A.dsViewerDefaults={_constructor:"DetailViewer",recordsPerBlock:4,blockSeparator:"",canSelectText:true,overflow:"visible",emptyMessage:"Please select a DataSource",fields:[{name:"dsName",title:"DataSource ID"},{name:"dsType",title:"Type"},{name:"filename",title:"DataSource File"},{name:"testData",title:"Test Data"},{name:"testDataFilename",title:"Test Data File"}]};isc.A.dsContentsToolbarDefaults={_constructor:"Toolbar",membersMargin:10,buttons:[{title:"Refresh",width:100,click:"this.parentElement.creator.dsContents.data.invalidateCache()"},{title:"Delete Selected",width:150,click:"this.parentElement.creator.dsContents.removeSelectedData()"}]};isc.A.dsContentsDefaults={_constructor:"ListGrid",showFilterEditor:true,showHiddenFields:true,showCellContextMenus:true,canEdit:true,listEndEditAction:"next"};isc.A.dsOptionsDefaults={_constructor:"DynamicForm",fields:[{name:"currentDB",type:"blurb"},{name:"importTestData",type:"checkbox",title:"Import Test Data (if present)",defaultValue:true},{name:"replaceTables",type:"checkbox",title:"Generate (or replace) tables",defaultValue:true}]};isc.A.dsActionsDefaults={_constructor:"Toolbar",buttons:[{title:"Import",width:100,click:"this.parentElement.creator.verifyImportDataSources()"}]};isc.A=isc.DSImporter.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.creatorName="dsImporter";isc.B.push(isc.A.initWidget=function isc_DSImporter_initWidget(){this.Super("initWidget",arguments);this.dsList=this.createAutoChild("dsList");this.dsListToolbar=this.createAutoChild("dsListToolbar");this.dsViewer=this.createAutoChild("dsViewer");this.dsContentsToolbar=this.createAutoChild("dsContentsToolbar");this.dsContents=this.createAutoChild("dsContents");this.dsOptions=this.createAutoChild("dsOptions");this.dsActions=this.createAutoChild("dsActions");this.addMembers([isc.VLayout.create({autoDraw:false,height:"33%",showResizeBar:true,members:[this.dsList,this.dsListToolbar]}),isc.VLayout.create({autoDraw:false,members:[this.dsViewer,this.dsContentsToolbar,this.dsContents,this.dsOptions,this.dsActions]})])}
,isc.A.getDefinedDataSources=function isc_DSImporter_getDefinedDataSources(){isc.DMI.call({appID:"isc_builtin",className:"com.isomorphic.tools.BuiltinRPC",methodName:"getDefinedDataSources",callback:this.getID()+".dsList.setData(data);",requestParams:{prompt:"Please wait - loading list of available DataSources.",showPrompt:true}})}
,isc.A.verifyImportDataSources=function isc_DSImporter_verifyImportDataSources(){if(this.dsList.getSelection().length==0){isc.say("Please select a DataSource to work with first.");return}
var _1=this.dsOptions.getValues();if(_1.replaceTables&&this.dsList.getSelection().getProperty("dsType").contains("hibernate"))
{var _2="<font color='red'><b>WARNING: </b></font>Hibernate DataSources cannot "+"be dropped and recreated individually. If you proceed, <b>ALL</b> of your "+"Hibernate-managed tables will be dropped and recreated.  <b>Note that this "+"even includes Hibernate-managed entities that have no corresponding DataSource "+"and are not used by SmartClient at all!</b>";if(_1.importTestData)_2+="<p>Test data will also be imported for all "+"Hibernate DataSources.";_2+="<p>Are you sure you want to continue?<p>"
var _3=this;isc.ask(_2,function(_4){if(_4)_3.importDataSources()})}else{this.importDataSources()}}
,isc.A.importDataSources=function isc_DSImporter_importDataSources(){var _1=this.dsOptions.getValues();_1.dsList=this.dsList.getSelection().getProperty("dsName").getUniqueItems();isc.DMI.call({appID:"isc_builtin",className:"com.isomorphic.tools.AdminConsole",methodName:"importDataSources",callback:"isc.say(data)",arguments:[_1.dsList,_1.importTestData,_1.replaceTables],requestParams:{prompt:"Importing Datasource[s] - This may take a few minutes.",showPrompt:true}})}
);isc.B._maxIndex=isc.C+4;isc.defineClass("DBConfigurator","VLayout");isc.A=isc.DBConfigurator.getPrototype();isc.A.dbListDefaults={_constructor:"ListGrid",selectionType:"single",recordClick:function(_1,_2){this.creator.dbForm.setData(isc.clone(_2));this.creator.dbForm.show();this.creator.dbForm.markForRedraw()},contextMenu:{data:[{title:"Add New",click:"target.dbConfigurator.dbForm.clearValues()"},{isSeparator:true},{title:"Refresh",click:"target.dbConfigurator.getDefinedDatabases()"}]},fields:[{name:"dbName",title:"Database Name",formatCellValue:function(_1,_2,_3,_4,_5){var _6=_2.isDefault;return _6?"<b>"+_1+"</b> (default)":_1}},{name:"database.type",title:"Database type"},{name:"driver.serverName",title:"Server Name"},{name:"dbStatus",title:"Status"}]};isc.A.dbListButtonsDefaults={_constructor:"Toolbar",buttons:[{title:"Refresh",width:100,overflow:"visible",height:20,click:"this.dbConfigurator.getDefinedDatabases()"},{title:"Add New Configuration",width:150,overflow:"visible",height:20,click:"this.dbConfigurator.dbForm.clearValues(); this.dbConfigurator.dbForm.show()"},{title:"Set As Default Database",width:150,overflow:"visible",height:20,click:function(){var _1=this.dbConfigurator.dbList.getSelectedRecord();if(_1)this.dbConfigurator.setDefaultDB(_1.dbName)}},{title:"Browse",width:150,overflow:"visible",height:20,extraSpace:20,click:"this.dbConfigurator.browseDatabase()"},{title:"Download server.properties",width:200,overflow:"visible",height:20,click:function(){isc.DS.load("Filesystem",this.dbConfigurator.getID()+".downloadServerProperties()")}}]};isc.A.dbFormConstructor="DBForm";isc.A.dbFormButtonsDefaults={_constructor:"Toolbar",cellSpacing:10,buttons:[{title:"Test",width:100,click:"this.dbConfigurator.testDB()"},{title:"Save",width:100,click:"this.dbConfigurator.saveDB()"},{title:"Cancel",width:100,click:"this.dbConfigurator.dbForm.clearValues()"}]};isc.A=isc.DBConfigurator.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.creatorName="dsConfigurator";isc.B.push(isc.A.initWidget=function isc_DBConfigurator_initWidget(){this.Super("initWidget",arguments);this.dbList=this.createAutoChild("dbList");this.dbListButtons=this.createAutoChild("dbListButtons",{buttonProperties:{dbConfigurator:this}});this.dbForm=this.createAutoChild("dbForm");this.dbFormButtons=this.createAutoChild("dbFormButtons",{buttonProperties:{dbConfigurator:this}});this.addMembers([isc.VLayout.create({autoDraw:false,showResizeBar:true,members:[this.dbList,this.dbListButtons]}),isc.VLayout.create({autoDraw:false,members:[this.dbForm,this.dbFormButtons]})])}
,isc.A.browseDatabase=function isc_DBConfigurator_browseDatabase(){var _1=this.dbList.getSelectedRecord();isc.DatabaseBrowser.create({autoCenter:true,canDragReposition:false,width:"90%",height:"90%",dbName:_1.dbName,closeClick:function(){this.destroy()}}).show()}
,isc.A.downloadServerProperties=function isc_DBConfigurator_downloadServerProperties(){var _1="/WEB-INF/classes/server.properties",_2=isc.DataSource.getDataSource("Filesystem"),_3=this;_2.fetchData({path:_1},function(_4){_3.downloadServerPropertiesReply(_4.data)},{operationId:"loadFile"})}
,isc.A.downloadServerPropertiesReply=function isc_DBConfigurator_downloadServerPropertiesReply(_1){if(isc.isAn.Array(_1))_1=_1[0];isc.DMI.callBuiltin({methodName:"downloadClientContent",arguments:[_1.contents,"server.properties","text"],requestParams:{transport:"hiddenFrame",downloadResult:true,showPrompt:false}})}
,isc.A.getDefinedDatabases=function isc_DBConfigurator_getDefinedDatabases(){isc.DMI.call({appID:"isc_builtin",className:"com.isomorphic.tools.AdminConsole",methodName:"getDefinedDatabases",callback:this.getID()+".getDefinedDatabasesCallback(data)",requestParams:{prompt:"Please wait - getting list and status of configured database.",showPrompt:true}})}
,isc.A.getDefinedDatabasesCallback=function isc_DBConfigurator_getDefinedDatabasesCallback(_1){for(var i=0;i<_1.length;i++){if(_1[i].isDefault)this.creator.defaultDatabaseID=_1[i].dbName;if(_1[i]['driver.url']){_1[i].useURL=true;_1[i]["driver.serverName"]="Embedded in JDBC URL"}}
this.dbList.setData(_1)}
,isc.A.setDefaultDB=function isc_DBConfigurator_setDefaultDB(_1){isc.DMI.call({appID:"isc_builtin",className:"com.isomorphic.tools.AdminConsole",methodName:"setDefaultDB",arguments:[_1],callback:this.getID()+".setDefaultDBCallback(data)"})}
,isc.A.setDefaultDBCallback=function isc_DBConfigurator_setDefaultDBCallback(_1){isc.say("Default database is now: <b>"+_1+"<p><i>Please wait for the container to reload before continuing."+"<br>Note that you may need to explicitly restart your servlet engine if you"+" encounter difficulty accessing this database.</i>")}
,isc.A.testDB=function isc_DBConfigurator_testDB(){if(!this.dbForm.validate())return;var _1=this.dbForm.getValue("dbName");var _2=this.dbForm.getValues();isc.DMI.call({appID:"isc_builtin",className:"com.isomorphic.tools.AdminConsole",methodName:"testDB",arguments:[_1,_2],callback:this.getID()+".testDBCallback(data)",requestParams:{willHandleError:true}})}
,isc.A.testDBCallback=function isc_DBConfigurator_testDBCallback(_1){isc.say(_1,{title:"Result of test"})}
,isc.A.saveDB=function isc_DBConfigurator_saveDB(){if(!this.dbForm.validate())return;isc.RPCManager.startQueue();isc.DMI.call({appID:"isc_builtin",className:"com.isomorphic.tools.AdminConsole",methodName:"saveDBConfig",arguments:[this.dbForm.getValues()],callback:this.getID()+".saveDBCallback(data)"});this.getDefinedDatabases();isc.RPCManager.sendQueue()}
,isc.A.saveDBCallback=function isc_DBConfigurator_saveDBCallback(_1){var _2=this.dbForm.getValue('dbName');isc.say("Saved configuration for database '"+_2+"."+"<p><i>Please wait for the container to reload before continuing."+"<br>Note that you may need to explicitly restart your servlet engine if you"+" encounter difficulty accessing this database.</i>")}
);isc.B._maxIndex=isc.C+12;isc.defineClass("DBForm","DynamicForm");isc.A=isc.DBForm.getPrototype();isc.A.titleWidth=200;isc.A.items=[{type:"text",title:"Database Name",name:"dbName",required:true},{change:"form.setDBFormDefaults()",type:"select",valueMap:{db2:"DB2",hsqldb:"HSQLDB",mysql:"MySQL",oracle:"Oracle",postgresql:"PostgreSQL",sqlserver:"SQLServer"},title:"Database Type",name:"database.type",required:true,redrawOnChange:true},{change:"form.setDBFormDefaults()",type:"select",valueMap:{dataSource:"DataSource",driverManager:"DriverManager",jndi:"App Server (JNDI)"},title:"Obtain Connections Using",name:"interface.type",required:true,redrawOnChange:true},{type:"hidden",defaultValue:"_container_",name:"driver.context"},{type:"text",hint:"e.g. jdbc/myDB",title:"JNDI Name",name:"name",showIf:"form.getValue('interface.type') == 'jndi'",validators:[{type:"requiredIf",expression:"item.isVisible()"}]},{type:"text",width:300,title:"Driver Implementer",name:"driver",validators:[{type:"requiredIf",expression:"item.isVisible()"}],showIf:"form.getValue('interface.type') != 'jndi'"},{change:"form.setDBFormDefaults()",type:"checkbox",title:"Specify explicit JDBC URL",name:"useURL",redrawOnChange:true,showIf:"form.getValue('interface.type') == 'driverManager'",_constructor:"FormItem"},{type:"text",width:400,title:"Driver URL",name:"driver.url",validators:[{type:"requiredIf",expression:"item.isVisible()"}],showIf:"form.getValue('useURL') && form.getValue('interface.type') != 'jndi'"},{type:"text",defaultValue:"localhost",title:"Server Name",name:"driver.serverName",validators:[{type:"requiredIf",expression:"item.isVisible()"}],showIf:"form.dsShowIf()"},{type:"text",title:"Port Number",name:"driver.portNumber",validators:[{type:"requiredIf",expression:"item.isVisible()"}],showIf:"form.dsShowIf()"},{type:"text",title:"Database Name/SID",name:"driver.databaseName",validators:[{type:"requiredIf",expression:"item.isVisible()"}],showIf:"form.dsShowIf()"},{type:"text",title:"User",name:"driver.user",validators:[{type:"requiredIf",expression:"item.isVisible()"}],showIf:"form.dsShowIf() || !form.getValue('interface.credentialsInURL')"},{type:"text",title:"Password",name:"driver.password",required:false,showIf:"form.dsShowIf() || !form.getValue('interface.credentialsInURL')"},{type:"boolean",name:"interface.credentialsInURL",title:"Pass credentials in JDBC URL",defaultValue:true,redrawOnChange:true,showIf:"form.getValue('interface.type') == 'driverManager'",itemHoverHTML:function(){return"If unchecked, credentials are omitted from the JDBC URL "+"and passed to DriverManager.getConnection() instead"}},{title:"Driver Name",name:"driver.driverName",validators:[{type:"requiredIf",expression:"item.isVisible()"}],showIf:"form.getValue('interface.type') == 'driverManager' && !form.getValue('useURL')"},{defaultValue:"thin",title:"Driver Type",name:"driver.driverType",validators:[{type:"requiredIf",expression:"item.isVisible()"}],showIf:"form.getValue('interface.type') == 'dataSource' && form.getValue('database.type') == 'oracle'"},{defaultValue:"tcp",title:"Network Protocol",name:"driver.networkProtocol",showIf:"form.getValue('interface.type') == 'dataSource'"},{type:"checkbox",title:"Enable ISC Connection Pooling",name:"pool.enabled",showIf:"form.getValue('interface.type') != 'jndi'"}];isc.A=isc.DBForm.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.B.push(isc.A.dsShowIf=function isc_DBForm_dsShowIf(){return(this.getValue('interface.type')!='jndi'&&!this.getValue('useURL'))}
,isc.A.setDBFormDefaults=function isc_DBForm_setDBFormDefaults(){var _1=this;var _2=_1.getValue('database.type');var _3=_1.getValue('interface.type');if(_3=='jndi')return;var _4='';if(_2=='mysql')_4='3306';else if(_2=='postgresql')_4='5432';else if(_2=='oracle')_4='1521';else if(_2=='sqlserver')_4='1433';else if(_2=='db2')_4='6789'
_1.setValue('driver.portNumber',_4);var _5='';if(_3=='dataSource'){if(_2=='oracle')_5='oracle.jdbc.pool.OracleDataSource';if(_2=='mysql')_5='com.mysql.jdbc.jdbc2.optional.MysqlDataSource';if(_2=='sqlserver')_5='com.microsoft.sqlserver.jdbc.SQLServerDriver';if(_2=='postgresql')_5='';if(_2=='db2')_5='COM.ibm.db2.jdbc.DB2DataSource'}
if(_3=='driverManager'){if(_2=='oracle')_5='oracle.jdbc.driver.OracleDriver';if(_2=='mysql')_5='org.gjt.mm.mysql.Driver';if(_2=='sqlserver')_5='';if(_2=='postgresql')_5='org.postgresql.Driver';if(_2=='db2')_5=''}else{_1.setValue('useURL',false)}
_1.setValue('driver',_5);var _6=_1.getValue('driver.serverName');if(_6=='Embedded in JDBC URL')_1.setValue('driver.serverName','');if(_1.getValue('useURL')==false)_1.setValue('driver.url','');var _7='';if(_3=='driverManager')_7=_2;_1.setValue('driverName',_7)}
);isc.B._maxIndex=isc.C+2;isc._moduleEnd=isc._DBConsole_end=(isc.timestamp?isc.timestamp():new Date().getTime());if(isc.Log&&isc.Log.logIsInfoEnabled('loadTime'))isc.Log.logInfo('DBConsole module init time: ' + (isc._moduleEnd-isc._moduleStart) + 'ms','loadTime');delete isc.definingFramework;}else{if(window.isc && isc.Log && isc.Log.logWarn)isc.Log.logWarn("Duplicate load of module 'DBConsole'.");}

/*

  SmartClient Ajax RIA system
  Version 8.0/LGPL Development Only (2010-05-18)

  Copyright 2000 and beyond Isomorphic Software, Inc. All rights reserved.
  "SmartClient" is a trademark of Isomorphic Software, Inc.

  LICENSE NOTICE
     INSTALLATION OR USE OF THIS SOFTWARE INDICATES YOUR ACCEPTANCE OF
     ISOMORPHIC SOFTWARE LICENSE TERMS. If you have received this file
     without an accompanying Isomorphic Software license file, please
     contact licensing@isomorphic.com for details. Unauthorized copying and
     use of this software is a violation of international copyright law.

  DEVELOPMENT ONLY - DO NOT DEPLOY
     This software is provided for evaluation, training, and development
     purposes only. It may include supplementary components that are not
     licensed for deployment. The separate DEPLOY package for this release
     contains SmartClient components that are licensed for deployment.

  PROPRIETARY & PROTECTED MATERIAL
     This software contains proprietary materials that are protected by
     contract and intellectual property law. You are expressly prohibited
     from attempting to reverse engineer this software or modify this
     software for human readability.

  CONTACT ISOMORPHIC
     For more information regarding license rights and restrictions, or to
     report possible license violations, please contact Isomorphic Software
     by email (licensing@isomorphic.com) or web (www.isomorphic.com).

*/

